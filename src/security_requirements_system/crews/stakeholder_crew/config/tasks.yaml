analyze_stakeholders:
  description: >
    Based on the following application requirements:

    {requirements_text}

    And the following architecture analysis:

    {architecture_summary}

    Your goal is to perform a comprehensive stakeholder analysis.

    CRITICAL INSTRUCTIONS:
    1. Identify ALL stakeholders and user personas in the system. For each, provide:
       - Role name (e.g., "Patient", "Healthcare Provider", "System Administrator")
       - Description of the role and their typical activities
       - Privilege level (e.g., Admin, User, Guest, Service Account)
       - Key security concerns specific to this role
       - Trust level (Trusted, Partially Trusted, Untrusted)
    
    2. Consider both human and automated stakeholders:
       - End users (patients, customers, etc.)
       - Administrative users
       - Third-party integrators
       - Service accounts and APIs
       - External systems
    
    3. Describe the trust model:
       - How are trust boundaries established?
       - What security mechanisms enforce boundaries (authentication, authorization, network segmentation)?
       - Which stakeholders can access which data/functionality?
       - How does the principle of least privilege apply?
    
    4. Think about privilege escalation risks and cross-boundary access patterns
    
    5. Output as clean, well-formatted MARKDOWN matching the structure below.
  expected_output: >
    A comprehensive stakeholder analysis in MARKDOWN format with the following structure:
    
    IMPORTANT: Output the markdown content directly. DO NOT wrap your output in ```markdown code blocks.
    
    ### 3.1. Identified Stakeholders and User Personas
    
    A markdown table with columns: Role | Privilege Level | Trust Level | Key Security Concerns
    
    Example:
    | Role | Privilege Level | Trust Level | Key Security Concerns |
    |------|-----------------|-------------|----------------------|
    | Patient | User | Partially Trusted | Unauthorized access to medical records, Identity theft through compromised credentials... |
    | Healthcare Provider | User | Trusted | Data breach during patient consultation, Phishing attacks targeting credentials... |
    | System Administrator | Admin | Trusted | Privilege escalation by malicious insiders, Account compromise leading to system-wide access... |
    | Third-Party EHR System | Service Account | Partially Trusted | Insecure API integration exposing patient data, Lack of proper authentication mechanisms... |
    
    ### 3.2. Trust Model
    
    A detailed paragraph explaining:
    - How trust boundaries are established (e.g., "Trust boundaries are established at the user interface, backend server, and database levels...")
    - Security mechanisms enforcing boundaries (authentication methods, RBAC, network segmentation)
    - Which stakeholders can access which data/functionality
    - How principle of least privilege is implemented
    
    Example:
    "Trust boundaries are established at the user interface, backend server, and database levels. Security mechanisms enforcing boundaries include user authentication (email/password and social login integration), role-based access control (RBAC) to ensure users can only access data and functionalities pertinent to their roles, and network segmentation to mitigate risks of unauthorized access. Patients can only access their personal medical records; Healthcare Providers have access to patient records they are treating; Admins have access to comprehensive management functions. The principle of least privilege is implemented by granting users the minimum access necessary to perform their responsibilities, thereby reducing the risk of data exposure and privilege escalation."
  agent: stakeholder_analyst

