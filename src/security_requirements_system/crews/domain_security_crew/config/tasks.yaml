map_security_controls:
  description: >
    You have been provided with a list of high-level functional requirements:

    {high_level_requirements}

    Your task is to analyze EACH requirement ONE BY ONE and map it to specific,
    relevant OWASP ASVS security controls.

    CRITICAL INSTRUCTIONS:
    1.  Iterate through each high-level requirement from the input list.
    2.  For each requirement, formulate SEVERAL specific, targeted search queries
        that capture the essence of the security risks for that feature.
        - BAD QUERY (generic): "authentication security"
        - GOOD QUERY (specific): "secure multi-factor authentication implementation"
        - GOOD QUERY (specific): "protection against credential stuffing attacks"
    3.  Use the "Query Security Standards Database" tool with these specific queries
        to find relevant OWASP controls. You MUST query the database for EACH
        high-level requirement.
    4.  From the tool's results, select the 3-5 MOST relevant OWASP controls
        that apply directly to the high-level requirement being analyzed.
    5.  For each selected control, you MUST provide:
        - The EXACT `req_id`, `chapter`, `section`, `level`, and `requirement` text
          from the tool output. DO NOT MODIFY OR FABRICATE THIS DATA.
        - A detailed `relevance` explanation, clearly describing WHY this specific
          control is critical for the high-level requirement.
        - Actionable `integration_tips` on how a development team could
          implement this security control in practice.
    6.  Structure the final output as a valid JSON object as specified below.
  expected_output: >
    A JSON object matching the DomainSecurityOutput schema.
  agent: domain_security_expert

