map_security_controls:
  description: >
    You have been provided with a list of high-level functional requirements:

    {high_level_requirements}

    Your task is to map each requirement to relevant security controls from OWASP ASVS, NIST SP 800-53, and ISO 27001.

    Instructions:
    1. For each requirement, use the "Query Security Standards Database" tool to find relevant controls.
       Call the tool with a specific query (e.g., "authentication", "encryption", "access control").
       Do NOT specify a standard_filter - let the tool find the best matches across all standards.
    
    2. From the tool results, select 3-8 most relevant controls per requirement.
       Use the EXACT data from the tool output: standard, req_id, chapter, section, requirement text, level.
    
    3. For each control, provide:
       - relevance: Why this control applies (2-3 sentences)
       - integration_tips: How to implement it (2-3 sentences)
       - priority: Critical, High, Medium, or Low
       - verification_method: How to verify implementation
    
    4. Identify cross_functional_controls that apply globally (logging, encryption, error handling).
    
    5. Recommend a recommended_asvs_level (L1, L2, or L3) based on data sensitivity and compliance needs.
    
    IMPORTANT: You MUST use the tool to find controls. Copy control data exactly from tool results.
  expected_output: >
    A JSON object matching DomainSecurityOutput schema with security_controls for each requirement.
    Each control must include the standard field ("OWASP", "NIST", or "ISO27001").
  agent: domain_security_expert

